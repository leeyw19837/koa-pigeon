# TODO(jan): Add a Date type and get rid of all the ...AtString parameters
scalar GraphQLDateTime

type Query {
  footAssessment(
    patientId: ID!
    healthCareTeamId: ID!
    day: String!
    timezone: String = "+0800"
    # Remove this, the time on the server is accurate, it's just set to GMT
    nowString: String = "1970-01-01T00:00:00.000Z"
  ): FootAssessment!
  footAssessments(patientId: ID!): [FootAssessment!]!
  treatmentState(
    patientId: ID!
    day: String
    timezone: String = "+0800"
  ): TreatmentState!
  treatmentStateApp(
    patientId:ID!
  ):TreatmentStateApp!
  treatmentStates(day: String, healthCareTeamId: ID!, timezone: String = "+0800"): [TreatmentState!]!
  photos(patientId: ID!, owner: String!): [Photo!]!
  chatMessages(appointmentId: ID!): ChatMessagesResponse!
  # Statistics
  totalTimeAtClinic: [DataPointNumberNumber!]!
  timeBetweenAppointments: [DataPointNumberNumberStdDev!]!
  activePatients: [DataPointNumberNumber!]!
  glucoseMeasurementTimeOfDay: [DataPointNumberNumberStdDev!]!
  # Users
  patient(patientId: ID, telephone: String): Patient
  patients: [Patient]
  patientsByStatus(status: String!): [Patient]
  healthCareProfessional(id: ID!): HealthcareProfessional
  healthCareProfessionals: [HealthcareProfessional]
  # Treatment plans
  treatmentPlan(patientId: ID!): [TreatmentPlan]
  # Measurements
  bloodGlucoseMeasurements(
    patientId: ID!
    from: Date
    to: Date
  ): [BloodGlucoseMeasurement]
  bloodGlucoseMeasurementsAndTreatmentPlans(
    patientId: ID!
    from: Date
    to: Date
  ): BloodGlucoseMeasurementsAndTreatmentPlans
  # Sms
  smses(currPage: Int!, size: Int!, mobile: String): SmsReponse
  fetchOrCreateNeedleChatRoom(userId: ID!): NeedleChatRoom!
  unreadMessages(userId: String!): Int!
  outreachs(period: String, startDay: Date): [Outreach]

  professionalLogin(username: String!, password: String!): HealthcareProfessional

  sentences(usedFor: Uses, authors: [String!]): [Sentence]
}

type Mutation {
  saveFootAssessment(
    recordId: ID!
    updatedAtString: String!
    assessmentDetailsJson: String!
    treatmentStateId: ID!
    footBloodAt: Boolean
    healthCareTeamId: ID!
  ): String
  savePhoto(
    patientId: ID!
    data: String!
    owner: String!
    note: String!
  ): Boolean!
  saveAssessmentTime(
    treatmentStateId: String!
    role: String!
    occurredAtString: String!
    action: String!
  ): Boolean!
  saveChatMessage(
    content: String!
    sentAtString: String!
    appointmentId: ID!
    senderNickname: String!
  ): Boolean!
  sendNeedleAudioChatMessage(
    userId: String!
    chatRoomId: ID!
    # The base64 encoded audio data. This gets turned into a URL on the server.
    base64EncodedAudioData: String!
  ): NeedleAudioMessage!
  # Posts an audio chat message to the given chat room.
  sendNeedleImageChatMessage(
    userId: String!
    chatRoomId: ID!
    # The base64 encoded audio data. This gets turned into a URL on the server.
    base64EncodedImageData: String!
  ): NeedleImageMessage!
  # Posts an text chat message to the given chat room.
  saveBloodGlucoseMeasurement(
    patientId: ID!
    bloodGlucose: BloodGlucoseInput!
    digestiveState: DigestiveState!
    measurementDeviceModel: DeviceModel!
    measuredAt: Date!
    deviceContext: DeviceContextInput!
  ): ID
  sendNeedleTextChatMessage(
    userId: String!
    chatRoomId: ID!
    text: String!
  ): NeedleTextMessage!
  updateLastSeenAt(userId: String!, chatRoomId: ID!): Boolean!
  sendMobileVerificationCode(mobile: String!): Int!
  saveCommunication(
    _id: ID
    patientId: ID!
    currentTopic: String!
    initiator: Roles!
    method: Method!
    nextTopic: String
    nextDate: Date
  ): Boolean!
  updateRemarkOfBloodglucoses(
    _id: ID!
    remark:String
  ):Boolean!

  deleteOfBloodglucoses(
    _id:ID!
  ):Boolean!

  addSentence(
    category: SoapCategory!
    segment: SoapSegment!
    dependence: ID
    value: String!
    usedFor: Uses!
  ): Boolean!
  removeSentence(_id: ID!): Boolean!
}

type Subscription {
  chatMessageAdded: NeedleChatMessage!
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
