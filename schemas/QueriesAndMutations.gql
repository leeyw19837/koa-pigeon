# TODO(jan): Add a Date type and get rid of all the ...AtString parameters
scalar GraphQLDateTime

type Query {
  footAssessment(
    patientId: ID!
    day: String!
    timezone: String = "+0800"
    # Remove this, the time on the server is accurate, it's just set to GMT
    nowString: String = "1970-01-01T00:00:00.000Z"
  ): FootAssessment!
  footAssessments(patientId: ID!): [FootAssessment!]!
  treatmentState(
    patientId: ID!
    day: String
    timezone: String = "+0800"
  ): TreatmentState!
  treatmentStates(day: String, timezone: String = "+0800"): [TreatmentState!]!
  photos(patientId: ID!, owner: String!): [Photo!]!
  chatMessages(appointmentId: ID!): ChatMessagesResponse!
  # Statistics
  totalTimeAtClinic: [DataPointNumberNumber!]!
  timeBetweenAppointments: [DataPointNumberNumberStdDev!]!
  activePatients: [DataPointNumberNumber!]!
  glucoseMeasurementTimeOfDay: [DataPointNumberNumberStdDev!]!
  # Users
  patient(patientId: ID, telephone: String): Patient
  patients: [Patient]
  patientsByStatus(status: String!): [Patient]
  healthCareProfessional(id: ID!): HealthcareProfessional
  healthCareProfessionals: [HealthcareProfessional]
  # Treatment plans
  treatmentPlan(patientId: ID!): [TreatmentPlan]
  # Measurements
  bloodGlucoseMeasurements(
    patientId: ID!
    from: Date
    to: Date
  ): [BloodGlucoseMeasurement]
  # Sms
  smses(currPage: Int!, size: Int!, mobile: String): SmsReponse
}

type Mutation {
  saveFootAssessment(
    recordId: ID!
    updatedAtString: String!
    assessmentDetailsJson: String!
    treatmentStateId: ID!
    footBloodAt: Boolean
  ): String
  savePhoto(
    patientId: ID!
    data: String!
    owner: String!
    note: String!
  ): Boolean!
  saveAssessmentTime(
    treatmentStateId: String!
    role: String!
    occurredAtString: String!
    action: String!
  ): Boolean!
  saveChatMessage(
    content: String!
    sentAtString: String!
    appointmentId: ID!
    senderNickname: String!
  ): Boolean!
  saveBloodGlucoseMeasurement(
    patientId: ID!
    bloodGlucose: BloodGlucoseInput!
    digestiveState: DigestiveState!
    measurementDeviceModel: DeviceModel!
    measuredAt: Date!
    deviceContext: DeviceContextInput!
  ): Boolean!
  sendNeedleAudioChatMessage(
    chatRoomId: ID!
    # The base64 encoded audio data. This gets turned into a URL on the server.
    base64EncodedAudioData: String!
  ): NeedleAudioMessage!
  # Posts an audio chat message to the given chat room.
  sendNeedleImageChatMessage(
    chatRoomId: ID!
    # The base64 encoded audio data. This gets turned into a URL on the server.
    base64EncodedImageData: String!
  ): NeedleImageMessage!
  # Posts an text chat message to the given chat room.
  sendNeedleTextChatMessage(chatRoomId: ID!, text: String!): NeedleTextMessage!
  saveBloodGlucoseMeasurement(
    patientId: ID!
    bloodGlucose: BloodGlucoseInput!
    digestiveState: DigestiveState!
    measurementDeviceModel: DeviceModel!
    measuredAt: Date!
    deviceContext: DeviceContextInput!
  ): Boolean!
}

schema {
  query: Query
  mutation: Mutation
}
